<%- include('layout_header',{searchTitle:null,nav_cur:'signup',messengerDefault:'不分訊息狀態',actionDefault:'建立日期',directorDefault:'大至小',keywordDefault:'',categoryDefault:'不分類'}); -%>
	<style>
	.hint{
	position:absolute;
	right:370px; 
	bottom:330px;
	}
	</style>
	<div align = "center">
	<button type="button" class="btn btn-default">
  	<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>個人資料登錄</button>
	<button type="button" class="btn btn-primary">
  	<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>帳號密碼設定</button>
	<button type="button" class="btn btn-default">
  	<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>社群資料提供</button>
	<button type="button" class="btn btn-default">
  	<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>帳戶建立完成</button>
	</div>
<center>
	<form method="post" action= "/signup/_community" onsubmit="return disableButton();">
		<h3>申請新帳號</h3>
		<br>
		<div class="input-group" style="text-align:center;">
			<label for="AccIpt">帳號</label>
			<input type="text" class="form-control" id="AccIpt" name="Username" placeholder="帳號" required="required" onblur="ifUsernameExist(true);return false;" onkeyup="value=value.replace(/[^\w]/ig,'');return false;"><br><span id="confirmMessage1" class="confirmMessage1" style="color:red;"></span>
		</div>
		<br>
		<div class="input-group" style="text-align:center;">
			<label for="PwdIpt">密碼</label>
			<input type="password" class="form-control" id="PwdIpt" name="Password" placeholder="密碼" required="required" onkeyup="value=value.replace(/[^\w]/ig,'');checkLength();checkPwd(); return false;"><br><span id="confirmMessage2" class="confirmMessage2" style="color:red;"></span>
		</div>
		<br>
		<div class="input-group" style="text-align:center;">
			<label for="2PwdIpt">密碼確認</label>
			<input type="password" class="form-control" id="2PwdIpt" name="Password2nd" placeholder="密碼確認" required="required" onkeyup="value=value.replace(/[^\w]/ig,'');checkPwd(); return false;"> <br><span id="confirmMessage3" class="confirmMessage3" style="color:red;"></span>
		</div>
		<div class="registrationFormAlert" id="divCheckPwd"></div>
		<br>
		<input type="hidden" name="Name" value="<%=Name%>">
		<input type="hidden" name="Email" value="<%=Email%>">
		<input type="hidden" name="Gender" value="<%=Gender%>">
		<input type="hidden" name="BirthDay" value="<%=BirthDay%>">
		<input type="hidden" name="Phone" value="<%=Phone%>">
		<input type="hidden" name="Address" value="<%=Address%>">
		<input type="hidden" name="IdCardNumber" value="<%=IdCardNumber%>">
		<input type="hidden" name="IdCardStr" value='<%-IdCardStr%>'>
		<input type="hidden" name="SecondCardStr" value='<%-SecondCardStr%>'>
		<input type="hidden" name="BankAccountNumber" value="<%=BankAccountNumber%>">
		<input type="hidden" name="BankAccountPassword" value="<%=BankAccountPassword%>">
		<input type="hidden" name="FormSession1" value="<%=formSession1%>">
		<input type="hidden" name="FormSession2" value="<%=formSession2%>">
		<div class="btn-toolbar" role="toolbar" style = "margin-top: 10px;">
			<button id="subBtnID" type="submit" class="btn btn-default btn-lg">
				  <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> 確認
			</button>
			<button id="cancelBtnID" type="button" class="btn btn-default btn-lg" onClick = "javascript:location.href='/'" >
				  <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> 關閉
			</button>
		</div>
	</form>
</center>
<div class = "hint">
	&nbsp;&nbsp;&nbsp;&nbsp;<div style="display:inline;"><img width="65px" height="65px" src="/images/icon.png" class="hastip" title="您只會有這一個帳號喔～<br>快設置獨一無二的吧!"/></div>
</div>
</center>
<script>
	var valiFlag1=false;
	var valiFlag2=false;
	var valiFlag3=false;
	var submitFlag=false;
	
	function start(){
		$('#subBtnID').addClass('disabled');
		$('#cancelBtnID').addClass('disabled');
	}
	
	function end(){
		$('#subBtnID').removeClass('disabled');
		$('#cancelBtnID').removeClass('disabled');
	}
	
	function disableButton(){
		if(!submitFlag){
			submitFlag=true;
			start();
			ifUsernameExist(false);
			checkLength();
			checkPwd();
			if(!valiFlag1){
				$('#AccIpt').focus();
				submitFlag=false;
				end();
				return false;
			}else if(!valiFlag2){
				$('#PwdIpt').focus();
				submitFlag=false;
				end();
				return false;
			}else if(!valiFlag3){
				$('#2PwdIpt').focus();
				submitFlag=false;
				end();
				return false;
			}else{
				return true;
			}
		}else{
			return false;
		}
	}
	
	function ifUsernameExist(asyncFlag)
	{
	    var username = $('#AccIpt').val().trim();
		if(username!==''){
			if(username.search(/[^\w]/ig)===-1){
				$('#confirmMessage1').html('正在比對中');
				$('#confirmMessage1').css('color','');
				$.ajax({ 
					url: '/Users/ifUsernameExist',
					type: 'POST',
					async: asyncFlag,
					data:{Urname:username},
					dataType: 'json',
					success: function(Jdata) {
						if(Jdata.success){
							if(Jdata.Valid){
								$('#confirmMessage1').html('沒有人正在使用此帳號！');
								$('#confirmMessage1').css('color','');
								valiFlag1=true;
							}else{
								$('#confirmMessage1').html('已經有人在使用此帳號！');
								$('#confirmMessage1').css('color','red');
								valiFlag1=false;
							}
						}else{
							$('#confirmMessage1').html(Jdata.error);
							valiFlag1=false;
						}
					},
					error: function() {
						$('#confirmMessage1').html('something wrong');
						valiFlag1=false;
					}
				});
			}else{
				$('#confirmMessage1').html('錯誤格式！');
				$('#confirmMessage1').css('color','red');
				valiFlag1=false;
			}
		}else{
			$('#confirmMessage1').html('必填欄位！');
			$('#confirmMessage1').css('color','red');
			valiFlag1=false;
		}
	}
	
	function checkLength()
	{
	    var pwd1 = $('#PwdIpt').val().trim();
	    if(pwd1!==''){
			if(pwd1.search(/[^\w]/ig)===-1){
				if(pwd1.length<=6){
					$('#confirmMessage2').html('密碼須大於六碼');
					$('#confirmMessage2').css('color','red');
					valiFlag2=false;
				}else{
					$('#confirmMessage2').html('密碼長度符合條件');
					$('#confirmMessage2').css('color','');
					valiFlag2=true;
				}
			}else{
				$('#confirmMessage2').html('錯誤格式！');
				$('#confirmMessage2').css('color','red');
				valiFlag2=false;
			}
		}else{
			$('#confirmMessage2').html('必填欄位！');
			$('#confirmMessage2').css('color','red');
			valiFlag2=false;
		}
	}
	
	function checkPwd()
	{
	    var pwd1 = $('#PwdIpt').val().trim();
	    var pwd2 = $('#2PwdIpt').val().trim();
		if(pwd2!==''){
			if(pwd2.search(/[^\w]/ig)===-1){
				if(pwd1 === pwd2){
					$('#confirmMessage3').html('輸入密碼相同');
					$('#confirmMessage3').css('color','');
					valiFlag3=true;
				}else{
					$('#confirmMessage3').html('請再次確認您輸入的密碼是否相同');
					$('#confirmMessage3').css('color','red');
					valiFlag3=false;
				}
			}else{
				$('#confirmMessage3').html('錯誤格式！');
				$('#confirmMessage3').css('color','red');
				valiFlag3=true;
			}
		}else{
			$('#confirmMessage3').html('必填欄位！');
			$('#confirmMessage3').css('color','red');
			valiFlag3=true;
		}
	}
</script>
<%- include('layout_footer',{imgSettingCode:"var ifLoadedCount=0;",imgDrawingCode:"",nav_cur:'signup'}); -%>