<%- include('layout_header',{searchTitle:oneidDefault,nav_cur:'lenderTransactionRecord',messengerDefault:'不分訊息狀態',actionDefault:'建立日期',directorDefault:'大至小',keywordDefault:'',categoryDefault:'不分類'}); -%>
<div class="container">
	<div class="row">
		<div class="col-md-9">
			<div class="bigTitle">借出紀錄 - <%=filterDefault%></div>
				<div class="subTitle">&nbsp;<%=totalResultNum%>&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;<%=pageNumber%>&nbsp;page</div>
				<br>
				<div class="resp2">
					<div class="input-group">
						<input type="text" class="form-control pageBar" id="oneidIpt" placeholder="搜尋故事標題或用戶名稱" value="<%=oneidDefault%>" onkeypress="if(event.keyCode===13){linker();}">	
						<span class="input-group-btn">
							<div class="btn-group">
								<button type="button" class="btn btn-default dropdown-toggle pageBar" data-toggle="dropdown" id="filterSelected">
									<%=filterDefault%> <span class="caret"></span>
								</button>
								<ul class="dropdown-menu">
									<li style="display:none"><a href="#" id="filter0"><%=filterDefault%></a></li>
									<li id="flis1"<%if(filterDefault==='不分類'){%> class="active"<%}%>><a href="#" onclick="filterSelector(1);return false;" id="filter1">不分類</a></li>
									<li id="flis2"<%if(filterDefault==='未保險'){%> class="active"<%}%>><a href="#" onclick="filterSelector(2);return false;" id="filter2">未保險</a></li>
									<li id="flis3"<%if(filterDefault==='已保險'){%> class="active"<%}%>><a href="#" onclick="filterSelector(3);return false;" id="filter3">已保險</a></li>
									<li id="flis4"<%if(filterDefault==='已結清'){%> class="active"<%}%>><a href="#" onclick="filterSelector(4);return false;" id="filter4">已結清</a></li>
								</ul>
							</div>
							<div class="btn-group">
								<button type="button" class="btn btn-default dropdown-toggle pageBar" data-toggle="dropdown" id="messengerSelected">
									<%=messengerDefault%> <span class="caret"></span>
								</button>
								<ul class="dropdown-menu">
									<li style="display:none"><a href="#" id="messenger0"><%=messengerDefault%></a></li>
									<li id="mlis1"<%if(messengerDefault==='不分訊息種類'){%> class="active"<%}%>><a href="#" onclick="messengerSelector(1);return false;" id="messenger1">不分訊息種類</a></li>
									<li id="mlis2"<%if(messengerDefault==='收到訊息'){%> class="active"<%}%>><a href="#" onclick="messengerSelector(2);return false;" id="messenger2">收到訊息</a></li>
									<li id="mlis3"<%if(messengerDefault==='送出訊息'){%> class="active"<%}%>><a href="#" onclick="messengerSelector(3);return false;" id="messenger3">送出訊息</a></li>
								</ul>
							</div>
							<div class="btn-group">
								<button type="button" class="btn btn-default dropdown-toggle pageBar" data-toggle="dropdown" id="classorSelected">
									<%=classorDefault%> <span class="caret"></span>
								</button>
								<ul class="dropdown-menu">
									<li style="display:none"><a href="#" id="classor0"><%=classorDefault%></a></li>
									<li id="clis1"<%if(classorDefault==='不分故事種類'){%> class="active"<%}%>><a href="#" onclick="classorSelector(1);return false;" id="classor1">不分故事種類</a></li>
									<li id="clis2"<%if(classorDefault==='一般'){%> class="active"<%}%>><a href="#" onclick="classorSelector(2);return false;" id="classor2">一般</a></li>
									<li id="clis3"<%if(classorDefault==='教育'){%> class="active"<%}%>><a href="#" onclick="classorSelector(3);return false;" id="classor3">教育</a></li>
									<li id="clis4"<%if(classorDefault==='家庭'){%> class="active"<%}%>><a href="#" onclick="classorSelector(4);return false;" id="classor4">家庭</a></li>
									<li id="clis5"<%if(classorDefault==='旅遊'){%> class="active"<%}%>><a href="#" onclick="classorSelector(5);return false;" id="classor5">旅遊</a></li>
								</ul>
							</div>
							<div class="btn-group">
								<button type="button" class="btn btn-default dropdown-toggle pageBar" data-toggle="dropdown" id="sorterSelected">
									<%=sorterDefault%> <span class="caret"></span>
								</button>
								<ul class="dropdown-menu">
									<li style="display:none"><a href="#" id="sorter0"><%=sorterDefault%></a></li>
									<li id="slis1"<%if(sorterDefault==='建立日期'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(1);return false;" id="sorter1">建立日期</a></li>
									<li id="slis2"<%if(sorterDefault==='更新日期'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(2);return false;" id="sorter2">更新日期</a></li>
									<li id="slis3"<%if(sorterDefault==='已得利息'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(3);return false;" id="sorter3">已得利息</a></li>
									<li id="slis4"<%if(sorterDefault==='已得本利和'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(4);return false;" id="sorter4">已得本利和</a></li>
									<li id="slis5"<%if(sorterDefault==='已得平均利息'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(5);return false;" id="sorter5">已得平均利息</a></li>
									<li id="slis6"<%if(sorterDefault==='已得平均本利和'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(6);return false;" id="sorter6">已得平均本利和</a></li>
									<li id="slis7"<%if(sorterDefault==='已得利本比'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(7);return false;" id="sorter7">已得利本比</a></li>
									<li id="slis8"<%if(sorterDefault==='年利率'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(8);return false;" id="sorter8">年利率</a></li>
									<li id="slis9"<%if(sorterDefault==='原始本金'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(9);return false;" id="sorter9">原始本金</a></li>
									<li id="slis10"<%if(sorterDefault==='額外本金'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(10);return false;" id="sorter10">額外本金</a></li>
									<li id="slis11"<%if(sorterDefault==='目前總本金'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(11);return false;" id="sorter11">目前總本金</a></li>
									<li id="slis12"<%if(sorterDefault==='未還本金'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(12);return false;" id="sorter12">未還本金</a></li>
									<li id="slis13"<%if(sorterDefault==='已還本金'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(13);return false;" id="sorter13">已還本金</a></li>
									<li id="slis14"<%if(sorterDefault==='原始期數'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(14);return false;" id="sorter14">原始期數</a></li>
									<li id="slis15"<%if(sorterDefault==='額外期數'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(15);return false;" id="sorter15">額外期數</a></li>
									<li id="slis16"<%if(sorterDefault==='目前總期數'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(16);return false;" id="sorter16">目前總期數</a></li>
									<li id="slis17"<%if(sorterDefault==='剩下期數'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(17);return false;" id="sorter17">剩下期數</a></li>
									<li id="slis18"<%if(sorterDefault==='已過期數'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(18);return false;" id="sorter18">已過期數</a></li>
									<li id="slis19"<%if(sorterDefault==='信用等級'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(19);return false;" id="sorter19">信用等級</a></li>
									<li id="slis20"<%if(sorterDefault==='預計剩餘利息'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(20);return false;" id="sorter20">預計剩餘利息</a></li>
									<li id="slis21"<%if(sorterDefault==='預計剩餘本利和'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(21);return false;" id="sorter21">預計剩餘本利和</a></li>
									<li id="slis22"<%if(sorterDefault==='預計剩餘平均利息'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(22);return false;" id="sorter22">預計剩餘平均利息</a></li>
									<li id="slis23"<%if(sorterDefault==='預計剩餘平均本利和'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(23);return false;" id="sorter23">預計剩餘平均本利和</a></li>
									<li id="slis24"<%if(sorterDefault==='預計剩餘利本比'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(24);return false;" id="sorter24">預計剩餘利本比</a></li>
									<li id="slis25"<%if(sorterDefault==='收款次數'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(25);return false;" id="sorter25">收款次數</a></li>
									<li id="slis26"<%if(sorterDefault==='上次成功收款日期'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(26);return false;" id="sorter26">上次成功收款日期</a></li>
									<li id="slis27"<%if(sorterDefault==='下次應收款日期'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(27);return false;" id="sorter27">下次應收款日期</a></li>
									<li id="slis28"<%if(sorterDefault==='保險所需費用'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(28);return false;" id="sorter28">保險所需費用</a></li>
									<li id="slis29"<%if(sorterDefault==='已付保險費用'){%> class="active"<%}%>><a href="#" onclick="sorterSelector(29);return false;" id="sorter29">已付保險費用</a></li>	
								</ul>
							</div>
							<div class="btn-group">
								<button type="button" class="btn btn-default pageBar" id="directorSelected" data-toggle="dropdown" aria-expanded="false"><%=directorDefault%> <span class='caret'></span></button>
								<ul class="dropdown-menu" role="menu">
									<li style="display:none"><a href="#" id="director0"><%=directorDefault%></a></li>
									<li id="dlis1"<%if(directorDefault==='大至小'){%> class="active"<%}%>><a href="#" onclick="directorSelector(1);return false;" id="director1">大至小</a></li>
									<li id="dlis2"<%if(directorDefault==='小至大'){%> class="active"<%}%>><a href="#" onclick="directorSelector(2);return false;" id="director2">小至大</a></li>
								</ul>
							</div>
							<div class="btn-group">
								<button type="button" class="btn btn-default pageBar" onclick="linker();">Go!</button>
							</div>
						</span>
					</div>
				</div>
				<br>
				<div class="resp">
					<table class="myResTable" width="100%">
						<tr>
							<td>
								<%if((sorterDefault==='建立日期')||(sorterDefault==='更新日期')||(sorterDefault==='上次成功收款日期')||(sorterDefault==='下次應收款日期')){%>
									<input type="text" placeholder="下限(年/月/日)" class="form-control boundIpt" value="<%=lboundDefault%>" id="lbound" onkeypress="if(event.keyCode===13){linker();}">&nbsp;&nbsp;<span id='lbd'></span>
									&nbsp;&nbsp;~&nbsp;&nbsp;&nbsp;&nbsp;
									<input type="text" placeholder="上限(年/月/日)" class="form-control boundIpt" value="<%=uboundDefault%>" id="ubound" onkeypress="if(event.keyCode===13){linker();}">&nbsp;&nbsp;<span id='ubd'></span>
								<%}else{%>
									<input type="text" placeholder="下限" class="form-control boundIpt" value="<%=lboundDefault%>" id="lbound" onkeypress="if(event.keyCode===13){linker();}">&nbsp;&nbsp;<span id='lbd'></span>
									&nbsp;&nbsp;~&nbsp;&nbsp;&nbsp;&nbsp;
									<input type="text" placeholder="上限" class="form-control boundIpt" value="<%=uboundDefault%>" id="ubound" onkeypress="if(event.keyCode===13){linker();}">&nbsp;&nbsp;<span id='ubd'></span>
								<%}%>
							</td>
						<%if((kpr!=='')&&(totalResultNum>0)&&(!oflg)&&(pflg)){%>
							<td align="right">
								&nbsp;&nbsp;&nbsp;&nbsp;
								<button class="btn btn-default disabled" style="display:none;" id="highlightBtn" onclick="enableHighlight();">
									關鍵字上色
								</button>
								<button class="btn btn-default" style="" id="unhighlightBtn" onclick="disableHighlight();">
									關鍵字去色
								</button>
							</td>
						<%}%>
						</tr>
					</table>
				</div>
				<br>
				<%if((biJSON)&&(filterDefault==='已保險')){%>
					<br>
					<%=biJSON.Contect%>
					<br>
					欲購買<%=biJSON.InfoJSON.counter1%>筆保險，其中<%=biJSON.InfoJSON.counter2%>筆成功，<%=biJSON.InfoJSON.counter1-biJSON.InfoJSON.counter2%>筆失敗
					<br>
					<div class="resp">	
						<table class="table myResTable inlineTable">
							<thead class="myThead">
								<tr>
									<th style="text-align:center">
									實際合計費用
									</th>
								</tr>
							</thead>
							<tbody class="myTbody">
								<tr>
									<td align="center">
										<%=biJSON.InfoJSON.info1.toFixed(0)%>元
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<br>
				<%}%>
				<% if(totalResultNum>0){ %>
					<br>
					<div class="resp">
						<table class="table myResTable inlineTable">
							<thead class="myThead">
								<tr>
									<th style="text-align:center">
									合計未還本金
									</th>
									<th style="text-align:center">
									合計剩餘總利息
									</th>
									<th style="text-align:center">
									合計剩餘本利和
									</th>
									<th style="text-align:center">
									合計剩餘平均利息
									</th>
									<th style="text-align:center">
									合計剩餘平均本利和
									</th>
									<th style="text-align:center">
									合計剩餘利本比
									</th>
								</tr>
							</thead>
							<tbody class="myTbody">
								<tr>
									<td align="center">
										<%=dpk.v1.toFixed(0)%>元
									</td>
									<td align="center">
										<%=dpk.v2.toFixed(0)%>元
									</td>
									<td align="center">
										<%=dpk.v3.toFixed(0)%>元
									</td>
									<td align="center">
										<%=dpk.v4.toFixed(0)%>元/月
									</td>
									<td align="center">
										<%=dpk.v5.toFixed(0)%>元/月
									</td>
									<td align="center">
									<%if(dpk.v1>0){%>
										<%=(dpk.v2/dpk.v1*100).toFixed(2)%>%
									<%}else{%>
										0.00%
									<%}%>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<br>
					<br>
					<div class="resp">
						<table class="table myResTable inlineTable">
							<thead class="myThead">
								<tr>
									<th style="text-align:center">
									合計已還本金
									</th>
									<th style="text-align:center">
									合計已得利息
									</th>
									<th style="text-align:center">
									合計已得本利和
									</th>
									<th style="text-align:center">
									合計已得平均利息
									</th>
									<th style="text-align:center">
									合計已得平均本利和
									</th>
									<th style="text-align:center">
									合計已得利本比
									</th>
								</tr>
							</thead>
							<tbody class="myTbody">
								<tr>
									<td align="center">
										<%=dpk.v6.toFixed(0)%>元
									</td>
									<td align="center">
										<%=dpk.v7.toFixed(0)%>元
									</td>
									<td align="center">
										<%=dpk.v8.toFixed(0)%>元
									</td>
									<td align="center">
										<%=dpk.v9.toFixed(0)%>元/月
									</td>
									<td align="center">
										<%=dpk.v10.toFixed(0)%>元/月
									</td>
									<td align="center">
									<%if(dpk.v6>0){%>
										<%=(dpk.v7/dpk.v6*100).toFixed(2)%>%
									<%}else{%>
										0.00%
									<%}%>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<% if(filterDefault==='未保險'){%>
						<br>
						<br>
						<div class="resp">	
							<table class="table myResTable inlineTable">
								<thead class="myThead">
									<tr>
										<th style="text-align:center">
										可支付餘額
										</th>
										<th style="text-align:center">
										已選合計費用
										</th>
										<%if(pageNumber>1){%>
											<th style="text-align:center">
											全部合計費用
											</th>
										<%}%>
									</tr>
								</thead>
								<tbody class="myTbody">
									<tr>
										<td align="center">
											<%=dpk.moneyLeftToHendLend.toFixed(0)%>元
										</td>
										<td align="center">
											<span id="selectedFee">0</span><span style="display:none;" id="selectedFeeR">0</span>元
										</td>
										<%if(pageNumber>1){%>
											<td align="center">
												<span id="selectedFeeAll"><%=selectedFeeAll.toFixed(0)%></span>元
											</td>
										<%}%>
									</tr>
								</tbody>
							</table>
						</div>
						<br>
						<br>
						<div class="input-group actioner">
							<span class="input-group-addon">
								<input type="checkbox" id="selectAll" onclick="selectAllFun();">
							</span>
							<span class="input-group-btn">
								<div class="btn-group">
									<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
										動作 <span class="caret"></span>
									</button>
									<ul class="dropdown-menu">
										<li><a href="#" onclick="$('#selectAll').prop('checked', true);selectAllFun();return false;">全選</a></li>
										<li><a href="#" onclick="$('#selectAll').prop('checked', false);selectAllFun();return false;">全不選</a></li>
										<li><a href="#" onclick="reverseAllFun();return false;">反選</a></li>
									</ul>
								</div>
							</span>
						</div>
						<br>
						<br>
						<button type="button" class="btn btn-info" onclick="checkAndOpenModal('#chkModal2');">
							購買保險
						</button>
						<%if(pageNumber>1){%>
							&nbsp;&nbsp;
							<button type="button" class="btn btn-info" data-toggle="modal" data-target="#chkModal1">
								全部購買
							</button>
						<%}%>
						<br>
						<br>
						<%if(pageNumber>1){%>
							<div class="modal fade" id="chkModal1">
								<div class="modal-dialog modal-sm">
									<div class="modal-content">
										<div class="modal-header" style="text-align: center;">
											<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
											<h4 class="modal-title">再次確認</h4>
										</div>
										<div class="modal-body" style="text-align: center;">
											<br>
											您確定要為所有交易購買保險嗎?
											<br>
											<br>
										</div>
										<div class="modal-footer" style="text-align: center;">
											<button type="button" class="btn btn-primary" id="buyBtnAll" onclick="buyAll();">
												確定
											</button>
											&nbsp;
											<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
										</div>
									</div>
								</div>
							</div>
						<%}%>
						<div class="modal fade" id="chkModal2">
							<div class="modal-dialog modal-sm">
								<div class="modal-content">
									<div class="modal-header" style="text-align: center;">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
										<h4 class="modal-title">再次確認</h4>
									</div>
									<div class="modal-body" style="text-align: center;">
										<br>
										您確定要為已選之<span id="seCtr1"></span>筆交易購買保險嗎?
										<br>
										<br>
									</div>
									<div class="modal-footer" style="text-align: center;">
										<button type="button" class="btn btn-primary" id="buyBtn" onclick="buy();">
											確定
										</button>
										<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
									</div>
								</div>
							</div>
						</div>
						<div class="modal fade" id="msgModal">
							<div class="modal-dialog modal-sm">
								<div class="modal-content">
									<div class="modal-header" style="text-align: center;">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
										<h4 class="modal-title">訊息</h4>
									</div>
									<div class="modal-body" style="text-align: center;">
										<br>
										您未選擇交易！
										<br>
										<br>
									</div>
									<div class="modal-footer" style="text-align: center;">
										<button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
									</div>
								</div>
							</div>
						</div>
					<%}else if(filterDefault==='已保險'){%>
						<br>
						<br>
						<div class="resp">
							<table class="table myResTable inlineTable">
								<thead class="myThead">
									<tr>
										<th style="text-align:center">
										可支付餘額
										</th>
										<th style="text-align:center">
										合計已繳保險費用
										</th>
									</tr>
								</thead>
								<tbody class="myTbody">
									<tr>
										<td align="center">
											<%=dpk.moneyLeftToHendLend.toFixed(0)%>元
										</td>
										<td align="center">
											<%=dpk.v11.toFixed(0)%>元
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<br>
						<br>
					<%}else{%>
						<br>
						<br>
					<%}%>
					<% for(var i=0; i<jsonTransaction.length; i++) { %>
						<div class="resp">
							<table class="myResTable" width="100%">
								<tr>
									<td>
										<%if(jsonTransaction[i].CreatedFrom.Type==="toBorrow"){%>
											<a class="m2" href="/lender/lenderReceiveMessages?msgKeyword=<%=jsonTransaction[i].CreatedFrom._id%>&filter=<%if(jsonTransaction[i].CreatedFrom.Status==="NotConfirmed"){%><%=encodeURIComponent('未確認')%><%}else if(jsonTransaction[i].CreatedFrom.Status==="Confirmed"){%><%=encodeURIComponent('已同意')%><%}else if(jsonTransaction[i].CreatedFrom.Status==="Rejected"){%><%=encodeURIComponent('已婉拒')%><%}%>&classor=<%=encodeURIComponent("不分故事種類");%>&sorter=<%=encodeURIComponent("更新日期")%>&director=<%=encodeURIComponent("大至小");%>&lbound=&ubound=&page=1">查看來源訊息</a>
										<%}else if(jsonTransaction[i].CreatedFrom.Type==="toLend"){%>
											<a class="m2" href="/lender/lenderSendMessages?msgKeyword=<%=jsonTransaction[i].CreatedFrom._id%>&filter=<%if(jsonTransaction[i].CreatedFrom.Status==="NotConfirmed"){%><%=encodeURIComponent('未被確認')%><%}else if(jsonTransaction[i].CreatedFrom.Status==="Confirmed"){%><%=encodeURIComponent('已被同意')%><%}else if(jsonTransaction[i].CreatedFrom.Status==="Rejected"){%><%=encodeURIComponent('已被婉拒')%><%}%>&classor=<%=encodeURIComponent("不分故事種類");%>&sorter=<%=encodeURIComponent("更新日期")%>&director=<%=encodeURIComponent("大至小");%>&lbound=&ubound=&page=1">查看來源訊息</a>
										<%}%>
									</td>
								</tr>
							</table>
						</div>
						<div style="height: 580px;" class="panel panel-default pd">
							<div class="panel-body">
								<span class="m1">借給&nbsp;</span>
								<div class="m1 myTitle colorCnt"><%=jsonTransaction[i].Borrower.Username%></div>
								<br>
								&nbsp;&nbsp;在&nbsp;&nbsp;<a class="m2<%if(jsonTransaction[i].color==="color1"){%> color1<%}else if(jsonTransaction[i].color==="color2"){%> color2<%}else if(jsonTransaction[i].color==="color3"){%> color3<%}else if(jsonTransaction[i].color==="color4"){%> color4<%}else if(jsonTransaction[i].color==="color5"){%> color5<%}else if(jsonTransaction[i].color==="color6"){%> color6<%}else if(jsonTransaction[i].color==="color7"){%> color7<%}%>" href="/lender/story?id=<%=jsonTransaction[i].CreatedFrom.FromBorrowRequest._id%>"><span class="category">[<%if(jsonTransaction[i].CreatedFrom.FromBorrowRequest.Category==='general'){%>一般<%}else if(jsonTransaction[i].CreatedFrom.FromBorrowRequest.Category==='education'){%>教育<%}else if(jsonTransaction[i].CreatedFrom.FromBorrowRequest.Category==='family'){%>家庭<%}else if(jsonTransaction[i].CreatedFrom.FromBorrowRequest.Category==='tour'){%>旅遊<%}%>]</span>&nbsp;<%if(jsonTransaction[i].CreatedFrom.FromBorrowRequest.StoryTitle!==''){%><div class="colorCnt"><%-jsonTransaction[i].CreatedFrom.FromBorrowRequest.StoryTitle.replace(new RegExp(' ','g'),'&nbsp;')%></div><%}else{%>無標題<%}%></a>
								<br>
								<br>
								<div class="col-md-4">
									<table width="100%" height="460px">
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='原始本金'){%>stronger<%}else{%>myTitle<%}%>">原始本金：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].Principal.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='額外本金'){%>stronger<%}else{%>myTitle<%}%>">額外本金：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].ExtendPrincipal.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='目前總本金'){%>stronger<%}else{%>myTitle<%}%>">目前總本金：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].TotalPrincipalNow.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='未還本金'){%>stronger<%}else{%>myTitle<%}%>">未還本金：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].PrincipalNotReturn.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已還本金'){%>stronger<%}else{%>myTitle<%}%>">已還本金：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].PrincipalReturn.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='年利率'){%>stronger<%}else{%>myTitle<%}%>">年利率：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=(jsonTransaction[i].InterestRate*100).toFixed(2)%>%
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已得利息'){%>stronger<%}else{%>myTitle<%}%>">已得利息：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].Interest.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已得本利和'){%>stronger<%}else{%>myTitle<%}%>">已得本利和：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].PrincipalInterest.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已得平均利息'){%>stronger<%}else{%>myTitle<%}%>">已得平均利息：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].InterestMonth.toFixed(0)%>元/月
											</td>
										</tr>
									</table>
								</div>	
								<div class="col-md-4">	
									<table width="100%" height="460px">
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已得平均本利和'){%>stronger<%}else{%>myTitle<%}%>">已得平均本利和：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].PrincipalInterestMonth.toFixed(0)%>元/月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已得利本比'){%>stronger<%}else{%>myTitle<%}%>">已得利本比：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=(jsonTransaction[i].InterestDivPrincipal*100).toFixed(2)%>%
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='原始期數'){%>stronger<%}else{%>myTitle<%}%>">原始期數：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].MonthPeriod.toFixed(0)%>個月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='額外期數'){%>stronger<%}else{%>myTitle<%}%>">額外期數：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].ExtendMonthPeriod.toFixed(0)%>個月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='目前總期數'){%>stronger<%}else{%>myTitle<%}%>">目前總期數：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].TotalMonthPeriodNow.toFixed(0)%>個月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='剩下期數'){%>stronger<%}else{%>myTitle<%}%>">剩下期數：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].MonthPeriodLeft.toFixed(0)%>個月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已過期數'){%>stronger<%}else{%>myTitle<%}%>">已過期數：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].MonthPeriodPast.toFixed(0)%>個月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='信用等級'){%>stronger<%}else{%>myTitle<%}%>">信用等級：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].Level.toFixed(0)%>級
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='建立日期'){%>stronger<%}else{%>myTitle<%}%>">成交日期：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].Created.getFullYear()%>/<%if(jsonTransaction[i].Created.getMonth()<9){%>0<%}%><%=jsonTransaction[i].Created.getMonth()+1%>/<%if(jsonTransaction[i].Created.getDate()<10){%>0<%}%><%=jsonTransaction[i].Created.getDate()%>
											</td>
										</tr>
									</table>
								</div>
								<div class="col-md-4">	
									<table width="100%" height="460px">
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='預計剩餘總利息'){%>stronger<%}else{%>myTitle<%}%>">預計剩餘總利息：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].InterestInFuture.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='預計剩餘本利和'){%>stronger<%}else{%>myTitle<%}%>">預計剩餘本利和：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].MoneyFuture.toFixed(0)%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='預計剩餘平均利息'){%>stronger<%}else{%>myTitle<%}%>">預計剩餘平均利息：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].InterestInFutureMonth.toFixed(0)%>元/月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='預計剩餘平均本利和'){%>stronger<%}else{%>myTitle<%}%>">預計剩餘平均本利和：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].InterestInFutureMoneyMonth.toFixed(0)%>元/月
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='預計剩餘利本比'){%>stronger<%}else{%>myTitle<%}%>">預計剩餘利本比：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=(jsonTransaction[i].InterestInFutureDivMoney*100).toFixed(2)%>%
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='上次成功收款日期'){%>stronger<%}else{%>myTitle<%}%>">上次成功收款日期：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%if(jsonTransaction[i].previousPayDate){%><%=jsonTransaction[i].previousPayDate.getFullYear()%>/<%if(jsonTransaction[i].previousPayDate.getMonth()<9){%>0<%}%><%=jsonTransaction[i].previousPayDate.getMonth()+1%>/<%if(jsonTransaction[i].previousPayDate.getDate()<10){%>0<%}%><%=jsonTransaction[i].previousPayDate.getDate()%><%}else{%>無收款記錄<%}%>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='下次應收款日期'){%>stronger<%}else{%>myTitle<%}%>">下次應收款日期：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%if(jsonTransaction[i].nextPayDate){%><%=jsonTransaction[i].nextPayDate.getFullYear()%>/<%if(jsonTransaction[i].nextPayDate.getMonth()<9){%>0<%}%><%=jsonTransaction[i].nextPayDate.getMonth()+1%>/<%if(jsonTransaction[i].nextPayDate.getDate()<10){%>0<%}%><%=jsonTransaction[i].nextPayDate.getDate()%><%}else{%>已還清<%}%>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='保險所需費用'){%>stronger<%}else{%>myTitle<%}%>">保險所需費用：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="value1<%=i%>" style="display:none;"><%if(jsonTransaction[i].PrincipalNotReturn>0){%><%if(jsonTransaction[i].PrincipalNotReturn*insuranceRate<1){%>1<%}else{%><%=jsonTransaction[i].PrincipalNotReturn*insuranceRate%><%}%><%}else{%>0<%}%></span><%if(jsonTransaction[i].PrincipalNotReturn>0){%><%if(jsonTransaction[i].PrincipalNotReturn*insuranceRate<1){%>1<%}else{%><%=(jsonTransaction[i].PrincipalNotReturn*insuranceRate).toFixed(0)%><%}%><%}else{%>0<%}%>元
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;<span class="<%if(sorterDefault==='已付保險費用'){%>stronger<%}else{%>myTitle<%}%>">已付保險費用：</span>
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=jsonTransaction[i].InsuranceFeePaid.toFixed(0)%>元
											</td>
										</tr>
									</table>
								</div>
							</div>
						</div>
					<div class="resp">
						<table class="myResTable" width="100%">
							<tr>
								<%if(filterDefault==='未保險'){%>
									<td>
										<input type="checkbox" name="selectCheckBox" id="selectCheckBoxId<%=i%>" onclick="selectFun(<%=i%>);" value='{"TransactionID":"<%=jsonTransaction[i]._id%>"}'> 選擇
									</td>
								<%}else if(filterDefault==='不分類'){%>
									<td>
										<%if(jsonTransaction[i].PrincipalNotReturn>0){%>
											<%if(jsonTransaction[i].InsuranceFeePaid>0){%>
												已保險
											<%}else{%>
												<a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(jsonTransaction[i]._id)%>&filter=<%=encodeURIComponent('未保險')%>&messenger=<%=encodeURIComponent('不分訊息種類')%>&classor=<%=encodeURIComponent('不分故事種類')%>&sorter=<%=encodeURIComponent('建立日期')%>&director=<%=encodeURIComponent('大至小')%>&lbound=&ubound=&page=1">未保險</a>	
											<%}%>
										<%}else{%>
											已結清
										<%}%>
									</td>
								<%}%>
								<td align="right">
									<div class="m2">
										&nbsp;&nbsp;&nbsp;&nbsp;
										<%if(jsonTransaction[i].ReturnCount>0){%>
											<a<%if(sorterDefault==='收款次數'){%> class="stronger"<%}%> href="/lender/lenderReturnRecord?oneid=&id=<%=jsonTransaction[i]._id%>&messenger=<%=encodeURIComponent('不分訊息種類')%>&classor=<%=encodeURIComponent("不分故事種類");%>&sorter=<%=encodeURIComponent("建立日期")%>&director=<%=encodeURIComponent("大至小");%>&lbound=&ubound=&page=1">該交易有<%=jsonTransaction[i].ReturnCount.toFixed(0)%>筆收款記錄</a>
										<%}else{%>
											<span<%if(sorterDefault==='收款次數'){%> class="stronger"<%}%>>該交易有<%=jsonTransaction[i].ReturnCount%>筆收款記錄</span> 
										<%}%>
									&nbsp;&nbsp;&nbsp;&nbsp;
										<span<%if(sorterDefault==='更新日期'){%> class="stronger"<%}%>>Updated：</span><%=jsonTransaction[i].Updated.getFullYear()%>/<%if(jsonTransaction[i].Updated.getMonth()<9){%>0<%}%><%=jsonTransaction[i].Updated.getMonth()+1%>/<%if(jsonTransaction[i].Updated.getDate()<10){%>0<%}%><%=jsonTransaction[i].Updated.getDate()%>
									&nbsp;&nbsp;&nbsp;&nbsp;
										<span<%if(sorterDefault==='建立日期'){%> class="stronger"<%}%>>Created：</span><%=jsonTransaction[i].Created.getFullYear()%>/<%if(jsonTransaction[i].Created.getMonth()<9){%>0<%}%><%=jsonTransaction[i].Created.getMonth()+1%>/<%if(jsonTransaction[i].Created.getDate()<10){%>0<%}%><%=jsonTransaction[i].Created.getDate()%>
									&nbsp;&nbsp;&nbsp;&nbsp;
										<span id="noSpan<%=i%>">No.<%=(dvr*(targetPageNumber-1))+i+1%></span>
									</div>
								</td>
							<tr>
						</table>
					</div>
					<br>
				<%}%>
				<%if(filterDefault==='未保險'){%>
					<%if(pageNumber>1){%>
						<form action="/Transactions/buyInsuranceAll" method="post" id="formID0">
							<input type="hidden" name="oneid" id="oneidIpt" value="<%=oneidDefault%>">
							<input type="hidden" name="sorter" id="sorterIpt" value="<%=sorterDefault%>">
							<input type="hidden" name="director" id="directorIpt" value="<%=directorDefault%>">
							<input type="hidden" name="lbound" id="lboundIpt" value="<%=lboundDefault%>">
							<input type="hidden" name="ubound" id="uboundIpt" value="<%=uboundDefault%>">
							<input type="hidden" name="classor" id="classorIpt" value="<%=classorDefault%>">
							<input type="hidden" name="messenger" id="messengerIpt" value="<%=messengerDefault%>">
						</form>
					<%}%>
					<form action="/Transactions/buyInsurance" method="post" id="formID">
						<input type="hidden" name="JsonArrayString" id="hdnIpt">
					</form>
				<%}%>
				<br>
				<table width="100%">
					<tr>
						<td align="center">
							<nav>
							  <ul class="pagination">
								<li class="pagination-prev<% if(targetPageNumber===1){%> disabled<%}%>">
								<% if(targetPageNumber!==1){%>
									<a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=targetPageNumber-1%>">
								<%}else{%>
									<a href="#" onclick="return false;">
								<%}%>
								<span>&laquo;</span></a></li>
								<% if(pageNumber<=10){%>
									<% for(var j=1; j<=pageNumber; j++) { %>
										<li 
											<% if(targetPageNumber===j){%>
												class="active"
											<%}%>
										><a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=j%>"><%=j%></a></li>
									<%}%>
								<% }else{%>
									<% if(targetPageNumber>=pageNumber-3){%>
										<% for(var j=pageNumber-9; j<=pageNumber; j++) { %>
										<li 
											<% if(targetPageNumber===j){%>
												class="active"
											<%}%>
										><a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=j%>"><%=j%></a></li>
										<%}%>
									<%}else if(targetPageNumber<=5){%>
										<% for(var j=1; j<=10; j++) { %>
										<li 
											<% if(targetPageNumber===j){%>
												class="active"
											<%}%>
										><a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=j%>"><%=j%></a></li>
										<%}%>
									<%}else{%>
										<% for(var j=targetPageNumber-5; j<targetPageNumber; j++) { %>
										<li><a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=j%>"><%=j%></a></li>
										<%}%>
										<li class="active"><a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=targetPageNumber%>"><%=targetPageNumber%></a></li>
										<% for(var j=targetPageNumber+1; j<=targetPageNumber+4; j++) { %>
										<li><a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=j%>"><%=j%></a></li>
										<%}%>
									<%}%>
								<%}%>
								<li class="pagination-next<% if(targetPageNumber===pageNumber){%> disabled<%}%>">	
								<% if(targetPageNumber!==pageNumber){%>
									<a href="/lender/lenderTransactionRecord?oneid=<%=encodeURIComponent(oneidDefault)%>&filter=<%=encodeURIComponent(filterDefault)%>&messenger=<%=encodeURIComponent('messengerDefault')%>&classor=<%=encodeURIComponent(classorDefault)%>&sorter=<%=encodeURIComponent(sorterDefault)%>&director=<%=encodeURIComponent(directorDefault)%>&lbound=<%=encodeURIComponent(lboundDefault)%>&ubound=<%=encodeURIComponent(uboundDefault)%>&page=<%=targetPageNumber+1%>">
								<%}else{%>
									<a href="#" onclick="return false;">
								<%}%>
								<span>&raquo;</span></a></li>
							  </ul>
							</nav>
						</td>
					</tr>
				</table>
			<% }%>
		</div>
		<div class="col-md-3">
		</div>
	</div>
</div>
<script>
function messengerSelector(index){
	$('#messengerSelected').html('');
	$('#messengerSelected').html($('#messenger'+index).text());
	$('#messenger0').html($('#messengerSelected').text());
	$('#messengerSelected').append(' <span class=\'caret\'><\/span>');
	for(i=1;i<=3;i++){
		$('#mlis'+i).attr('class','');
	}
	$('#mlis'+index).attr('class','active');
	linker();
}

function classorSelector(index){
	$('#classorSelected').html('');
	$('#classorSelected').html($('#classor'+index).text());
	$('#classor0').html($('#classorSelected').text());
	$('#classorSelected').append(' <span class=\'caret\'><\/span>'); 
	for(i=1;i<=5;i++){
		$('#clis'+i).attr('class','');
	}
	$('#clis'+index).attr('class','active');
	linker();
}

function filterSelector(index){
	$('#filterSelected').html('');
	$('#filterSelected').html($('#filter'+index).text());
	$('#filter0').html($('#filterSelected').text());
	$('#filterSelected').append(' <span class=\'caret\'><\/span>'); 
	for(i=1;i<=4;i++){
		$('#flis'+i).attr('class','');
	}
	$('#flis'+index).attr('class','active');
	linker();
}

function sorterSelector(index){
	$('#lbound').val('');
	$('#ubound').val('');
	if(($('#sorter'+index).text()==='建立日期')||($('#sorter'+index).text()==='更新日期')||($('#sorter'+index).text()==='上次成功收款日期')||($('#sorter'+index).text()==='下次應收款日期')){
		enableDater();
	}else{
		disableDater();
	}
	
	$('#sorterSelected').html('');
	$('#sorterSelected').html($('#sorter'+index).text());
	<% if((filterDefault==='未保險')&&(pageNumber>1)){%>
		//$('#sorterIpt').val($('#sorterSelected').text());
	<%}%>
	$('#sorter0').html($('#sorterSelected').text());
	$('#sorterSelected').append(' <span class=\'caret\'><\/span>');
	
	for(i=1;i<=29;i++){
		$('#slis'+i).attr('class','');
	}
	$('#slis'+index).attr('class','active');
	spanner($('#sorter0').text());
	$('#lbound').trigger('change');
	$('#ubound').trigger('change');
	linker();
}

function directorSelector(index){
	$('#directorSelected').html('');
	$('#directorSelected').html($('#director'+index).text());
	<% if((filterDefault==='未保險')&&(pageNumber>1)){%>
		//$('#directorIpt').val($('#directorSelected').text());
	<%}%>
	$('#director0').html($('#directorSelected').text());
	$('#directorSelected').append(' <span class=\'caret\'><\/span>');
	for(i=1;i<=2;i++){
		$('#dlis'+i).attr('class','');
	}
	$('#dlis'+index).attr('class','active');
	linker();
}

<%if((sorterDefault==='建立日期')||(sorterDefault==='更新日期')||(sorterDefault==='上次成功收款日期')||(sorterDefault==='下次應收款日期')){%>
	var ifDater=true;
<%}else{%>
	var ifDater=false;
<%}%>

function enableDater(){
	if(!ifDater){
		$('#lbound').attr('placeholder','下限(年/月/日)');
		$('#ubound').attr('placeholder','上限(年/月/日)');
		$("#lbound").datepicker();
		$("#ubound").datepicker();
		ifDater=true;
	}
}

function disableDater(){
	if(ifDater){
		$('#lbound').attr('placeholder','下限');
		$('#ubound').attr('placeholder','上限');
		$('#lbound').datepicker( "destroy" );
		$('#lbound').removeClass("hasDatepicker");
		$('#ubound').datepicker( "destroy" );
		$('#ubound').removeClass("hasDatepicker");
		ifDater=false;
	}
}

function linker(){
	window.open('/lender/lenderTransactionRecord?oneid='+encodeURIComponent($('#oneidIpt').val())+'&filter='+encodeURIComponent($('#filter0').text())+'&messenger='+encodeURIComponent($('#messenger0').text())+'&classor='+encodeURIComponent($('#classor0').text())+'&sorter='+encodeURIComponent($('#sorter0').text())+'&director='+encodeURIComponent($('#director0').text())+'&lbound='+encodeURIComponent($('#lbound').val())+'&ubound='+encodeURIComponent($('#ubound').val())+'&page=1','_self');
}

<% if(totalResultNum>0){%>
	
	var stringPro='<%if((!oflg)&&(pflg)){%><%-kpr%><%}%>';
	var highLightFlag=false;
	var stringArray=[];
	var stringArray2=[];
	var stringArrayRegex=[];
	var stringArray2Regex=[];
	function enableHighlight(){
		if(stringPro!==''){
			if(!highLightFlag){
				highLightFlag=true;
				for(we=0;we<stringArray2Regex.length;we++){
					$('.colorCnt').highlightRegex(stringArray2Regex[we]);
				}
				for(we=0;we<stringArrayRegex.length;we++){
					$('.colorCnt').highlightRegex(stringArrayRegex[we]);
				}
				$('#unhighlightBtn').removeClass('disabled');
				$('#unhighlightBtn').show();
				$('#highlightBtn').addClass('disabled');
				$('#highlightBtn').hide();
			}
		}
	}
	
	function disableHighlight(){
		if(stringPro!==''){
			if(highLightFlag){
				highLightFlag=false;
				$('.colorCnt').highlightRegex();
				$('#highlightBtn').removeClass('disabled');
				$('#highlightBtn').show();
				$('#unhighlightBtn').addClass('disabled');
				$('#unhighlightBtn').hide();
			}
		}
	}
	function spanner(tgtString){
		if((tgtString==='建立日期')||(tgtString==='更新日期')||(tgtString==='上次成功收款日期')||(tgtString==='下次應收款日期')){
			$('#lbd').html('');
			$('#ubd').html('');
		}else if((tgtString==='原始期數')||(tgtString==='額外期數')||(tgtString==='目前總期數')||(tgtString==='剩下期數')||(tgtString==='已過期數')){
			$('#lbd').html('個月');
			$('#ubd').html('個月');
		}else if((tgtString==='年利率')||(tgtString==='已得利本比')||(tgtString==='預計剩餘利本比')){
			$('#lbd').html('%');
			$('#ubd').html('%');
		}else if(tgtString==='信用等級'){
			$('#lbd').html('級');
			$('#ubd').html('級');
		}else if(tgtString==='收款次數'){
			$('#lbd').html('次');
			$('#ubd').html('次');
		}else if((tgtString==='已得平均利息')||(tgtString==='已得平均本利和')||(tgtString==='預計剩餘平均利息')||(tgtString==='預計剩餘平均本利和')){
			$('#lbd').html('元/月');
			$('#ubd').html('元/月');
		}else{
			$('#lbd').html('元');
			$('#ubd').html('元');
		}
	}
	
	var toselect = [];
	function overlap(a, b) {
		var l = b.length,
			m = a.length;
		for (var j = 1; j < l; j++) {
			if (a.indexOf(b.substr(l - j)) === 0) {
				toselect.push(b.concat(a.substr(j)));
			} else if (a.substr(m - j).indexOf(b.substr(0, j)) === 0) {
				toselect.push(a.concat(b.substr(j)));
			}
		}
	}
	function overdiag(arr) {
		toselect = []; //empties to select
		$.each(arr, function (i) {
			$.each(arr.slice(i + 1), function (i, v) {
				overlap(arr[i], v);
			});
		});
	}
	
	$(document).ready(function(){
		<% if((totalResultNum>0)&&(filterDefault==='未保險')){%>
			$("#selectAll").prop("checked", false);
			$("input[name='selectCheckBox']").each(function() {
				$(this).prop("checked", false);
			});
		<%}%>
		
		if(ifDater){
			$("#lbound").datepicker();
			$("#ubound").datepicker();
		}
		
		spanner($('#sorter0').text());
		if(stringPro!==''){
			stringPro=stringPro.replace(/\s\s+/g,' ');
			stringArray=stringPro.split(' ');
			for(j=stringArray.length-1;j>-1;j--){
				if(stringArray[j].charAt(0)==='-'){
					stringArray.splice(j,1);
				}else if((stringArray[j].charAt(0)==='"')&&(stringArray[j].charAt(stringArray[j].length-1)==='"')){
					var tempCnt=stringArray[j].substring(1);
					tempCnt=tempCnt.substring(0,tempCnt.length-1);
					stringArray2.push(tempCnt);
					stringArray.splice(j,1);
				}
			}
			overdiag(stringArray);
			stringArray = stringArray.concat(toselect);
			stringArray = $.grep(stringArray, function (a, b) {
				return $.inArray(a,stringArray) === b;
			});
			stringArray.sort(function(a, b){
				return b.length - a.length;
			});
			stringArray2.sort(function(a, b){
				return b.length - a.length;
			});
			for(we=0;we<stringArray.length;we++){
				stringArrayRegex.push(new RegExp(stringArray[we].replace(/\./g,'\\.'),'ig'));
			}
			for(we=0;we<stringArray2.length;we++){
				var temperrr=stringArray2[we].replace(/%/g,'[^\\w\\u0800-\\u9fa5]+').replace(/\./g,'\\.');
				stringArray2Regex.push(new RegExp('(^|[^\\w\\u0800-\\u9fa5])'+temperrr+'($|[^\\w\\u0800-\\u9fa5])','ig'));
			}
			enableHighlight();
		}
	});

	<% if(filterDefault==='未保險'){%>
		function checkAndOpenModal(target){
			var ctr=0;
			$("input[name='selectCheckBox']").each(function() {
					if($(this).prop("checked")){
						ctr+=1;
					}
			});
			if(ctr>0){
				if(target==='#chkModal2'){
					$('#seCtr1').html(ctr);
				}
				$(target).modal('show');
			}else{
				$('#msgModal').modal('show');
			}
		}
		
		function reverseAllFun(){
			$("input[name='selectCheckBox']").each(function() {
				var target=$(this).attr('id').replace('selectCheckBoxId','');
				if($(this).prop("checked")){
					$(this).prop("checked", false);
				}else{
					$(this).prop("checked", true);
				}
				selectFun(target);
			});
		}

		function selectAllFun(){
			if($("#selectAll").prop("checked"))
			{
				$("input[name='selectCheckBox']").each(function() {
					$(this).prop("checked", true);
				});
				var valueR=0;
				for(i=0;i<<%=jsonTransaction.length%>;i++){
					valueR+=parseFloat($("#value1"+i).text());
					$('#noSpan'+i).addClass('red');
				}
				$("#selectedFee").text(Math.round(valueR).toFixed(0));
				$("#selectedFeeR").text(valueR);
			}else{
				$("input[name='selectCheckBox']").each(function() {
					$(this).prop("checked", false);
				});
				for(i=0;i<<%=jsonTransaction.length%>;i++){
					$('#noSpan'+i).removeClass('red');
				}
				$("#selectedFee").text(0);	
				$("#selectedFeeR").text(0);		
			}
		}

		function selectFun(index){
			var valueR=parseFloat($("#selectedFeeR").text());
			var fee=parseFloat($("#value1"+index).text());
			
			if($("#selectCheckBoxId"+index).prop("checked"))
			{
				valueR+=fee;
				$("#selectedFee").text(Math.round(valueR).toFixed(0));
				$("#selectedFeeR").text(valueR);
				
				var ctr=0;
				$("input[name='selectCheckBox']").each(function() {
					if($(this).prop("checked")){
						ctr+=1;
					}
				});
				if(ctr===$("input[name='selectCheckBox']").length){
					$("#selectAll").prop("checked", true);
				}
				
				$('#noSpan'+index).addClass('red');
			}else{
				valueR-=fee;
				$("#selectedFee").text(Math.round(valueR).toFixed(0));
				$("#selectedFeeR").text(valueR);

				var ctr=0;
				$("input[name='selectCheckBox']").each(function() {
					if($(this).prop("checked")){
						ctr+=1;
					}
				});
				if(ctr<$("input[name='selectCheckBox']").length){
					$("#selectAll").prop("checked", false);
				}
				
				$('#noSpan'+index).removeClass('red');
			}
		}

		<%if(pageNumber>1){%>
		var buyAllFlag=false;
		function buyAll(){
			if(!buyAllFlag){
				$('#chkModal1').modal('hide');
				disableButton();
				var form=document.getElementById('formID0');
				form.submit();
			}
		}
		<%}%>

		var buyFlag=false;
		function buy(){
			if(!buyFlag){
				$('#chkModal2').modal('hide');
				disableButton();
				samepart(buyInner);
			}
		}

		function disableButton(){
			buyFlag=true;
			$('#buyBtn').addClass('disabled');
			
			<%if(pageNumber>1){%>
				buyAllFlag=true;
				$('#buyBtnAll').addClass('disabled');
			<%}%>
		}

		function enableButton(){
			buyFlag=false;
			$('#buyBtn').removeClass('disabled');
			
			<%if(pageNumber>1){%>
				buyAllFlag=false;
				$('#buyBtnAll').removeClass('disabled');
			<%}%>
		}

		function buyInner(){
			var form=document.getElementById('formID');
			form.submit();
		}

		function samepart(toDO){
			var JSONarrayString='{"array":['
			$("input[name='selectCheckBox']").each(function() {
					if($(this).prop("checked")){
						JSONarrayString+=$(this).val();
						JSONarrayString+=',';
					}
			});
			if(JSONarrayString!=='{"array":['){
				JSONarrayString=JSONarrayString.substr(0,JSONarrayString.length-1);
				JSONarrayString+=']}';
				$("#hdnIpt").val(JSONarrayString);
				toDO();
			}
		}
	<%}%>
<%}%>
</script>
<%- include('layout_footer',{imgSettingCode:"var ifLoadedCount=0;",imgDrawingCode:"",nav_cur:'lenderTransactionRecord'}); -%>