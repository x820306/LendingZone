<%- include('layout_header',{nav_cur:'lend',actionDefault:'最新',keywordDefault:'',categoryDefault:'不分類'}); -%>
<div class="container">
	<div class="row">
		<div class="col-md-9">
				<div style="font-size:30pt;color:#337ab7;">自動借出設定</div>
				</br>
				<a href="/lendsList?sorter=<%=encodeURIComponent("最新");%>&page=1"><button type="button" class="btn btn-default">參考他人設定</button></a>
				</br>
				</br>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">銀行帳戶內餘額</h3>
					</div>
					<div style="color:#ccc;" class="panel-body">
						<input type="text" style="width:95%;" class="textForm" value="<%=MoneyInBankAccountValue%>" readonly="readonly" >&nbsp;元
					</div>					
				</div>
				</br>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">已借出金額</h3>
					</div>
					<div style="color:#ccc;" class="panel-body">
						<input type="text" style="width:95%;" class="textForm" value="<%=MoneyLended%>" readonly="readonly" >&nbsp;元
					</div>					
				</div>
				</br>
		<% if(!jsonLend){ %>
			<form action="/Lends/create" method="post" id="formID">
		<% }else{ %>
			<form action="/Lends/update" method="post" id="formID">
		<% } %>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">最大可借出金額</h3>
					</div>
					<div class="panel-body">
						<% if(!jsonLend){ %>
							<input type="number" style="width:95%;" class="textForm" name="MaxMoneyToLend">
						<% }else{ %>
							<input type="number" style="width:95%;" class="textForm" name="MaxMoneyToLend" value="<%=jsonLend.MaxMoneyToLend%>">
						<% } %>
						&nbsp;元
					</div>					
				</div>
				</br>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">欲借出利率</h3>
					</div>
					<div class="panel-body">
						<% if(!jsonLend){ %>
							<input type="text" style="width:95%;" class="textForm" name="InterestRate">
						<% }else{ %>
							<input type="text" style="width:95%;" class="textForm" name="InterestRate" value="<%=jsonLend.InterestRate*100%>">
						<% } %>
						%
					</div>
				</div>
				</br>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">期數（單位/月）</h3>
					</div>
					<div class="panel-body">
						<% if(!jsonLend){ %>
							<input type="number" style="width:95%;" class="textForm" name="MonthPeriod">
						<% }else{ %>
							<input type="number" style="width:95%;" class="textForm" name="MonthPeriod" value="<%=jsonLend.MonthPeriod%>">
						<% } %>
						&nbsp;個月
					</div>
				</div>
				</br>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">最低可接受信用等級</h3>
					</div>
					<div class="panel-body">
						<% if(!jsonLend){ %>
							<input type="number" style="width:95%;" class="textForm" name="MinLevelAccepted">
						<% }else{ %>
							<input type="number" style="width:95%;" class="textForm" name="MinLevelAccepted" value="<%=jsonLend.MinLevelAccepted%>">
						<% } %>
						&nbsp;級
					</div>
				</div>
				</br>
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">自動同意借款請求</h3>
					</div>
					<div class="panel-body">
						<% if(!jsonLend){ %>
							 <select class="textForm" class="textForm" name="AutoComfirmToBorrowMsgPeriod" id="periodSel" onchange="if($('#periodSel').val()>0){$('#sorterSel').prop('disabled', false);$('#sorterPnl').attr('style','');}else{$('#sorterSel').prop('disabled', true);$('#sorterSel').val('-InterestRate');$('#sorterPnl').attr('style','display:none;');}">
								<option value=-1>永不自動同意</option>
								<option value=0>立即自動同意</option>
								<option value=1>每天自動同意一次</option>
								<option value=2>每兩天自動同意一次</option>
								<option value=3>每三天自動同意一次</option>
							  </select>
						<% }else{ %>
							<select class="textForm" class="textForm" name="AutoComfirmToBorrowMsgPeriod"  id="periodSel" onchange="if($('#periodSel').val()>0){$('#sorterSel').prop('disabled', false);$('#sorterPnl').attr('style','');}else{$('#sorterSel').prop('disabled', true);$('#sorterSel').val('-InterestRate');$('#sorterPnl').attr('style','display:none;');}">
								<option value=-1<%if(jsonLend.AutoComfirmToBorrowMsgPeriod==-1){%> selected<%}%>>永不自動同意</option>
								<option value=0<%if(jsonLend.AutoComfirmToBorrowMsgPeriod==0){%> selected<%}%>>立即自動同意</option>
								<option value=1<%if(jsonLend.AutoComfirmToBorrowMsgPeriod==1){%> selected<%}%>>每天自動同意一次</option>
								<option value=2<%if(jsonLend.AutoComfirmToBorrowMsgPeriod==2){%> selected<%}%>>每兩天自動同意一次</option>
								<option value=3<%if(jsonLend.AutoComfirmToBorrowMsgPeriod==3){%> selected<%}%>>每三天自動同意一次</option>
							  </select>
						<% } %>
					</div>
				</div>
				</br>
				<div class="panel panel-default" id="sorterPnl"<% if(!jsonLend){%> style="display:none;"<%}else{%><% if(jsonLend.AutoComfirmToBorrowMsgPeriod<=0){ %> style="display:none;"<%}%><%}%>>
					<div class="panel-heading">
						<h3 class="panel-title">自動同意優先順序</h3>
					</div>
					<div class="panel-body">
						<% if(!jsonLend){ %>
							<select class="textForm" class="textForm" name="AutoComfirmToBorrowMsgSorter" id="sorterSel" disabled="disabled">
								<option value="-InterestRate">利率最高</option>
								<option value="-MoneyToLend">金額最高</option>
								<option value="-MonthPeriod">期數最多</option>
								<option value="-Level">信用等級最高</option>
								<option value="-SpecialA">預計總利息最高</option>
								<option value="-SpecialB">預計平均利息最高</option>
								<option value="-SpecialC">預計平均本利和最高</option>
								<option value="-SpecialD">預計利本比最高</option>
								<option value="-Updated">最新</option>
							 </select>
						<% }else{ %>
							<select class="textForm" class="textForm" name="AutoComfirmToBorrowMsgSorter" id="sorterSel"<% if(jsonLend.AutoComfirmToBorrowMsgPeriod==-1){ %> disabled="disabled"<%}%>>
								<option value="-InterestRate"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-InterestRate"){%> selected<%}%>>利率最高</option>
								<option value="-MoneyToLend"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-MoneyToLend"){%> selected<%}%>>金額最高</option>
								<option value="-MonthPeriod"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-MonthPeriod"){%> selected<%}%>>期數最多</option>
								<option value="-Level"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-Level"){%> selected<%}%>>信用等級最高</option>
								<option value="-SpecialA"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-SpecialA"){%> selected<%}%>>預計總利息最高</option>
								<option value="-SpecialB"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-SpecialB"){%> selected<%}%>>預計平均利息最高</option>
								<option value="-SpecialC"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-SpecialC"){%> selected<%}%>>預計平均本利和最高</option>
								<option value="-SpecialD"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-SpecialD"){%> selected<%}%>>預計利本比最高</option>
								<option value="-Updated"<%if(jsonLend.AutoComfirmToBorrowMsgSorter=="-Updated"){%> selected<%}%>>最新</option>
							  </select>
						<% } %>
					</div>
				</div>
				</br>
				<% if(!jsonLend){ %>
					<div class="btn-toolbar" role="toolbar">
						<div class="btn-group" role="group">
							<button type="submit" class="btn btn-info" id="createBtnID" onclick="create()">新建</button>
						</div>
					</div>
				<% }else{ %>
					<input type="hidden" name="_id" value="<%=jsonLend._id%>">
					<div class="btn-toolbar" role="toolbar">
						<div class="btn-group" role="group">
							<button type="submit" class="btn btn-info" id="updateBtnID" onclick="update()">更新</button>
						</div>
						<div class="btn-group" role="group">
							<button type="button" class="btn btn-danger" id="destroyBtnID" onclick="destroy();">刪除</button>
						</div>
					</div>
				<% } %>
			</form>
		</div>
		<div class="col-md-3">
		</div>
	</div>
</div>
<script>
<% if(!jsonLend){ %>
	function create(){
		var orig=$('#createBtnID').attr('class');
		if(orig.search(' disabled')<0){
			orig=orig+' disabled';
			$('#createBtnID').attr('class',orig);
		}
	}
<% }else{%>
	function update(){
		var orig=$('#destroyBtnID').attr('class');
		if(orig.search(' disabled')<0){
			orig=orig+' disabled';
			$('#destroyBtnID').attr('class',orig);
		}
		
		var orig=$('#updateBtnID').attr('class');
		if(orig.search(' disabled')<0){
			orig=orig+' disabled';
			$('#updateBtnID').attr('class',orig);
		}
	}
	
	function destroy(){
		var orig=$('#destroyBtnID').attr('class');
		if(orig.search(' disabled')<0){
			orig=orig+' disabled';
			$('#destroyBtnID').attr('class',orig);
		}
		
		var orig=$('#updateBtnID').attr('class');
		if(orig.search(' disabled')<0){
			orig=orig+' disabled';
			$('#updateBtnID').attr('class',orig);
		}
		
		var form=document.getElementById('formID');
		form.action="/Lends/destroy";
		form.submit();
	}
<% }%>
</script>
<%- include('layout_footer'); -%>